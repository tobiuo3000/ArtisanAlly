(()=>{"use strict";var e={398:(e,t,n)=>{n.d(t,{_:()=>r});const a=document.getElementById("messageBox"),o=document.getElementById("inputMsg");function r(e,t){const n=document.createElement("div");n.classList.add("message"),n.classList.add("user"===t?"user-message":"ai-message"),n.textContent=e,a.appendChild(n),a.scrollTop=a.scrollHeight}document.getElementById("sendBtn").addEventListener("click",(async()=>{const e=o.value.trim();if(e){o.value="",r(e,"user");try{const t=await async function(e){return"「"+e+"」ね、あーしってるしってる。おいしいよね"}(e);r(t,"ai")}catch(e){console.error("Error getting AI response:",e),r("エラーが発生しました。","ai")}}}))},91:(e,t,n)=>{n.d(t,{S0:()=>s,j$:()=>i,x_:()=>c});const a=document.getElementById("uploadScreen"),o=document.getElementById("loadingScreen"),r=document.getElementById("resultScreen");function s(){a.classList.add("hidden"),o.classList.remove("hidden"),r.classList.add("hidden")}function i(){a.classList.add("hidden"),o.classList.add("hidden"),r.classList.remove("hidden")}function c(){a.classList.remove("hidden"),o.classList.add("hidden"),r.classList.add("hidden")}c()},60:(e,t,n)=>{n.d(t,{l:()=>s});const a=document.getElementById("toggle_switch1"),o=document.getElementById("toggle_switch2"),r=document.getElementById("tabbody");function s(e){document.querySelectorAll(".descriptionItem").forEach((e=>e.style.display="none")),document.getElementById(e).style.display="block";const t=document.querySelectorAll("#tabcontrol a");t.forEach((e=>e.classList.remove("active"))),t.forEach((e=>{e.firstElementChild.classList.remove("noneTransparent")}));const n=document.querySelector(`#tabcontrol a[href="#${e}"]`);n.classList.add("active"),n.firstElementChild.classList.add("noneTransparent"),r.style.backgroundColor=window.getComputedStyle(n).getPropertyValue("background-color")}document.querySelectorAll("#tabcontrol a").forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),s(e.getAttribute("href").substring(1))}))})),a.addEventListener("change",(()=>{if(o.checked&&(o.checked=!1),a.checked){const e=document.getElementById("heatmapImage").src;document.getElementById("originalImage").src=e}else document.getElementById("originalImage").src=originalImageUrl})),o.addEventListener("change",(()=>{if(a.checked&&(a.checked=!1),o.checked){const e=document.getElementById("backgroundRemovalImage").src;document.getElementById("originalImage").src=e}else document.getElementById("originalImage").src=originalImageUrl}))}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var r=t[a]={exports:{}};return e[a](r,r.exports,n),r.exports}n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var a=n(91),o=n(398),r=n(60);const s=document.getElementById("uploadTile"),i=document.getElementById("loadedimage"),c=document.getElementById("rep-colors"),l=document.getElementById("histogram"),d=document.getElementById("histogram-description"),m=document.getElementById("heatmap"),g=document.getElementById("heatmap-description"),u=document.getElementById("backgroundRemoval"),p=document.getElementById("toggle_switch1"),h=document.getElementById("toggle_switch2");firebase.apps.length||firebase.initializeApp({apiKey:"AIzaSyA-wjt8D4zYzLhj6HEeLRqjSDWmTrBku70",authDomain:"artisanallyproject.firebaseapp.com",projectId:"artisanallyproject",storageBucket:"artisanallyproject.firebasestorage.app",messagingSenderId:"471591578999",appId:"1:471591578999:web:4b37ca262aa514c91f8572"});const y=firebase.firestore(),f="rooms";let E=null,I=null;function _(e){console.log(e);const t=`https://storage.googleapis.com/${e.bucket_name}/images/`;let n=null;if("rep_colors"in e){n=function(e){const t=[];for(const[n,a]of Object.entries(e))t.push({id:n,values:a});return t.sort(((e,t)=>parseInt(e.id)-parseInt(t.id))),t}(e.rep_colors);for(const e in n){const t=document.createElement("div");t.id=e,t.className="drop-tile",t.style.backgroundColor=n[e],c.appendChild(t)}}if("original_image_name"in e){const a=e.original_image_name;I=t+a;const o=document.createElement("img");o.src=I,o.id="originalImage",o.style.maxWidth="100%",o.style.maxHeight="100%",i.style.backgroundColor=null!==n?n[0]:"#fff",i.innerHTML="",i.appendChild(o)}if("histogram_image_name"in e&&"histogram_explanation"in e){const n=t+e.histogram_image_name,a=e.histogram_explanation;l.innerHTML=`<img src="${n}" alt="Histogram">`,d.textContent=a}if("heatmap_image_name"in e&&"heatmap_explanation"in e){const n=t+e.heatmap_image_name,a=e.heatmap_explanation;p.checked=!1,m.innerHTML=`<img src="${n}" alt="Heatmap" id="heatmapImage">`,g.textContent=a}if("back_removed_image_name"in e){const n=t+e.back_removed_image_name;h.checked=!1,u.innerHTML=`<img src="${n}" alt="Heatmap" id="backgroundRemovalImage">`}if("main_explanation"in e){const t=e.main_explanation;(0,o._)(t,"ai")}(0,r.l)("tabpage1")}s.addEventListener("dragover",(e=>{e.preventDefault(),s.style.backgroundColor="#e0e0e0"})),s.addEventListener("dragleave",(e=>{e.preventDefault(),s.style.backgroundColor=""})),s.addEventListener("drop",(e=>{e.preventDefault(),s.style.backgroundColor="";const t=e.dataTransfer.files[0];t&&t.type.startsWith("image/")?async function(e){(0,a.S0)();try{const t=await function(e){return new Promise(((t,n)=>{const a=new FileReader;a.readAsDataURL(e),a.onload=()=>{const n=a.result.split(","),o=n[n.length-1];t({image:o,image_type:e.type.split("/")[1]})},a.onerror=e=>n(e)}))}(e),n=function(e){return console.log("/process-image"),console.log(e.image.substr(0,30)+"......"),console.log(e.image_type),"j1xs99a2ftshojouuuya"}(t),o=await async function(e){try{const t=await y.collection(f).doc(e).get();if(!t.exists)throw new Error("Firestore document not found.");return t.data()}catch(e){throw new Error(`Failed to fetch Firestore data: ${e.message}`)}}(n);_(o),(0,a.j$)(),function(e){E&&E(),E=y.collection(f).doc(e).onSnapshot((e=>{if(e.exists){const t=e.data();_(t),function(e){console.log("Data changed:",e)}(t)}else console.log("Document does not exist (anymore).")}),(e=>{console.error("Error in realtime listener:",e)}))}(n)}catch(e){console.error("Error processing image:",e),alert("Error: "+e.message),(0,a.x_)()}}(t):alert("画像ファイルをドロップしてください。")}))})();